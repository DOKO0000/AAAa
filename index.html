<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuarios</title>
    <!-- Agregar Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .info-box {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Información del Usuario</h1>
        <div class="info-box">
            <p id="userInfo">Cargando información...</p>
        </div>
    </div>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD9v2z6u1uK1ZQvWJmJ8X1ZQvWJmJ8X1ZQ",
            authDomain: "base-de-datos-ip-alupnos.firebaseapp.com",
            databaseURL: "https://base-de-datos-ip-alupnos-default-rtdb.firebaseio.com",
            projectId: "base-de-datos-ip-alupnos",
            storageBucket: "base-de-datos-ip-alupnos.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Función para obtener la IP del usuario
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Error al obtener IP:", error);
                return "Desconocida";
            }
        }

        // Función para obtener información del navegador
        function getBrowserInfo() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookiesEnabled: navigator.cookieEnabled,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                colorDepth: window.screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                doNotTrack: navigator.doNotTrack || "No especificado"
            };
        }

        // Función para obtener la ubicación aproximada (basada en IP)
        async function getLocation(ip) {
            try {
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                return {
                    ip: ip,
                    city: data.city || "Desconocida",
                    region: data.region || "Desconocida",
                    country: data.country_name || "Desconocida",
                    postal: data.postal || "Desconocido",
                    latitude: data.latitude || "Desconocida",
                    longitude: data.longitude || "Desconocida",
                    org: data.org || "Desconocida"
                };
            } catch (error) {
                console.error("Error al obtener ubicación:", error);
                return {
                    ip: ip,
                    city: "Desconocida",
                    region: "Desconocida",
                    country: "Desconocida",
                    postal: "Desconocido",
                    latitude: "Desconocida",
                    longitude: "Desconocida",
                    org: "Desconocida"
                };
            }
        }

        // Función para obtener la fecha y hora actual
        function getCurrentDateTime() {
            const now = new Date();
            return {
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                timestamp: now.getTime()
            };
        }

        // Función para guardar datos en Firebase
        function saveToFirebase(userData) {
            const timestamp = new Date().getTime();
            database.ref('users/' + timestamp).set(userData)
                .then(() => {
                    console.log("Datos guardados en Firebase");
                })
                .catch((error) => {
                    console.error("Error al guardar en Firebase:", error);
                });
        }

        // Función principal para recopilar y mostrar información
        async function collectAndDisplayInfo() {
            const ip = await getIP();
            const location = await getLocation(ip);
            const browserInfo = getBrowserInfo();
            const dateTime = getCurrentDateTime();

            const userData = {
                fecha: dateTime.date,
                hora: dateTime.time,
                timestamp: dateTime.timestamp,
                ip: ip,
                ubicacion: location,
                navegador: browserInfo,
                paginaVisitada: window.location.href,
                referrer: document.referrer || "Directo"
            };

            // Mostrar información en la página
            document.getElementById('userInfo').innerHTML = `
                <strong>Fecha y Hora:</strong> ${userData.fecha} - ${userData.hora}<br>
                <strong>IP:</strong> ${userData.ip}<br>
                <strong>Ubicación:</strong> ${userData.ubicacion.city}, ${userData.ubicacion.region}, ${userData.ubicacion.country}<br>
                <strong>Código Postal:</strong> ${userData.ubicacion.postal}<br>
                <strong>Coordenadas:</strong> Lat: ${userData.ubicacion.latitude}, Lon: ${userData.ubicacion.longitude}<br>
                <strong>Proveedor:</strong> ${userData.ubicacion.org}<br>
                <strong>Navegador:</strong> ${userData.navegador.userAgent}<br>
                <strong>Plataforma:</strong> ${userData.navegador.platform}<br>
                <strong>Idioma:</strong> ${userData.navegador.language}<br>
                <strong>Resolución:</strong> ${userData.navegador.screenWidth}x${userData.navegador.screenHeight}<br>
                <strong>Zona Horaria:</strong> ${userData.navegador.timezone}<br>
                <strong>Página Visitada:</strong> ${userData.paginaVisitada}<br>
                <strong>Origen:</strong> ${userData.referrer}
            `;

            // Guardar en Firebase
            saveToFirebase(userData);
        }

        // Ejecutar cuando la página cargue
        window.onload = collectAndDisplayInfo;
    </script>
</body>
</html>
